{"version":3,"file":"index.js","sources":["../src/index.js"],"sourcesContent":["import { Controller } from '@hotwired/stimulus';\nimport './index.scss';\n\nexport default class extends Controller {\n  static values = {\n    mode: String\n  };\n\n  get groups() {\n    return this.scope.findAllElements('[data-form-group-id]');\n  }\n\n  get togglers() {\n    return this.context.bindingObserver.bindings\n               .filter(binding => binding.action.methodName == 'toggle')\n               .map(binding => binding.action.element);\n  }\n\n  connect() {\n    this.enableAnim(false);\n    this.togglers.forEach(toggler => this.toggleBy(toggler));\n    setTimeout(() => this.enableAnim(true), 200);\n  }\n\n  enableAnim(enabled) {\n    this.groups.forEach(group => group.classList.toggle('st-form-groups--disable-anim', !enabled));\n  }\n\n  toggle(e) {\n    this.toggleBy(e.target);\n  }\n\n  toggleBy(elem) {\n    let method = this.toggleMethod();\n    this.groups.forEach(group => method(group, false));\n    this.findGroups(elem).forEach(group => method(group, true));\n  }\n\n  toggleMethod() {\n    if (this.modeValue == 'disabled') {\n      return this.toggleDisabled.bind(this);\n    } else {\n      return this.toggleVisible.bind(this);\n    }\n  }\n\n  toggleVisible(group, visible) {\n    group.style.display = visible ? '' : 'none';\n    group.classList.toggle('st-form-groups--fade-in', visible);\n  }\n\n  toggleDisabled(group, enabled) {\n    this.inputElements(group).forEach(elem => elem.disabled = !enabled);\n  }\n\n  inputElements(group) {\n    return group.querySelectorAll('input, select, textarea, button')\n  }\n\n  findGroups(target) {\n    let id = this.getGroupID(target);\n    if (!id) {\n      return [];\n    } else {\n      return this.groups.filter(group => this.parseJSON(group.getAttribute('data-form-group-id')).includes(id));\n    }\n  }\n\n  getGroupID(target) {\n    if (target.matches('select')) {\n      return target.options[target.selectedIndex].value;\n    } else if (target.matches('input[type=checkbox]')) {\n      return target.checked;\n    } else if (target.matches('input[type=radio]')) {\n      let checked = this.scope.findElement(`input[type=radio][name=\"${target.name}\"]:checked`);\n      return checked ? checked.value : null;\n    }\n  }\n\n  parseJSON(ids) {\n    try {\n      return [].concat(JSON.parse(ids));\n    } catch(e) {\n      return [].concat(ids);\n    }\n  }\n}\n"],"names":["Controller","groups","scope","findAllElements","togglers","context","bindingObserver","bindings","filter","binding","action","methodName","map","element","connect","this","enableAnim","forEach","toggler","toggleBy","setTimeout","enabled","group","classList","toggle","e","target","elem","method","toggleMethod","findGroups","modeValue","toggleDisabled","bind","toggleVisible","visible","style","display","inputElements","disabled","querySelectorAll","id","getGroupID","parseJSON","getAttribute","includes","matches","options","selectedIndex","value","checked","findElement","name","ids","concat","JSON","parse","values","mode","String"],"mappings":"oDAG6BA,aAKvBC,aACF,YAAYC,MAAMC,gBAAgB,wBAGhCC,eACF,YAAYC,QAAQC,gBAAgBC,SACxBC,OAAOC,GAAwC,UAA7BA,EAAQC,OAAOC,YACjCC,IAAIH,GAAWA,EAAQC,OAAOG,SAG5CC,UACEC,KAAKC,YAAW,GAChBD,KAAKX,SAASa,QAAQC,GAAWH,KAAKI,SAASD,IAC/CE,WAAW,IAAML,KAAKC,YAAW,GAAO,KAG1CA,WAAWK,GACTN,KAAKd,OAAOgB,QAAQK,GAASA,EAAMC,UAAUC,OAAO,gCAAiCH,IAGvFG,OAAOC,GACLV,KAAKI,SAASM,EAAEC,QAGlBP,SAASQ,GACP,IAAIC,EAASb,KAAKc,eAClBd,KAAKd,OAAOgB,QAAQK,GAASM,EAAON,GAAO,IAC3CP,KAAKe,WAAWH,GAAMV,QAAQK,GAASM,EAAON,GAAO,IAGvDO,eACE,MAAsB,YAAlBd,KAAKgB,eACKC,eAAeC,KAAKlB,WAEpBmB,cAAcD,KAAKlB,MAInCmB,cAAcZ,EAAOa,GACnBb,EAAMc,MAAMC,QAAUF,EAAU,GAAK,OACrCb,EAAMC,UAAUC,OAAO,0BAA2BW,GAGpDH,eAAeV,EAAOD,GACpBN,KAAKuB,cAAchB,GAAOL,QAAQU,GAAQA,EAAKY,UAAYlB,GAG7DiB,cAAchB,GACZ,OAAOA,EAAMkB,iBAAiB,mCAGhCV,WAAWJ,GACT,IAAIe,EAAK1B,KAAK2B,WAAWhB,GACzB,OAAKe,OAGSxC,OAAOO,OAAOc,GAASP,KAAK4B,UAAUrB,EAAMsB,aAAa,uBAAuBC,SAASJ,IAF9F,GAMXC,WAAWhB,GACT,GAAIA,EAAOoB,QAAQ,UACjB,OAAOpB,EAAOqB,QAAQrB,EAAOsB,eAAeC,SACnCvB,EAAOoB,QAAQ,wBACxB,OAAOpB,EAAOwB,WACLxB,EAAOoB,QAAQ,qBAAsB,CAC9C,IAAII,EAAUnC,KAAKb,MAAMiD,uCAAuCzB,EAAO0B,mBACvE,OAAOF,EAAUA,EAAQD,MAAQ,MAIrCN,UAAUU,GACR,IACE,MAAO,GAAGC,OAAOC,KAAKC,MAAMH,IAC5B,MAAM5B,GACN,MAAO,GAAG6B,OAAOD,OA/EdI,OAAS,CACdC,KAAMC"}