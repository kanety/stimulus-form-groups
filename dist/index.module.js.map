{"version":3,"file":"index.module.js","sources":["../src/index.js"],"sourcesContent":["import { Controller } from '@hotwired/stimulus';\nimport './index.scss';\n\nexport default class extends Controller {\n  static values = {\n    mode: String\n  };\n\n  get groups() {\n    return this.scope.findAllElements('[data-form-group-id]');\n  }\n\n  get togglers() {\n    return this.context.bindingObserver.bindings\n               .filter(binding => binding.action.methodName == 'toggle')\n               .map(binding => binding.action.element);\n  }\n\n  connect() {\n    this.enableAnim(false);\n    this.groups.forEach(group => this.toggleGroup(group, false));\n    this.togglers.forEach(toggler => this.toggleBy(toggler));\n    setTimeout(() => this.enableAnim(true), 200);\n  }\n\n  enableAnim(enabled) {\n    this.groups.forEach(group => {\n      if (enabled) {\n        group.classList.remove('st-form-groups--disable-trans')\n      } else {\n        group.classList.add('st-form-groups--disable-trans')\n      }\n    });\n  }\n\n  toggle(e) {\n    this.groups.forEach(group => this.toggleGroup(group, false));\n    this.togglers.forEach(toggler => this.toggleBy(toggler));\n  }\n\n  toggleBy(elem) {\n    this.findGroups(elem).forEach(group => this.toggleGroup(group, true));\n  }\n\n  toggleGroup(group, flag) {\n    if (this.modeValue == 'disabled') {\n      return this.toggleDisabled(group, flag);\n    } else {\n      return this.toggleVisible(group, flag);\n    }\n  }\n\n  toggleVisible(group, visible) {\n    if (visible) {\n      group.style.visibility = '';\n      group.style.overflow = '';\n      group.style.height = group.scrollHeight + 'px';\n      group.classList.add('st-form-groups__group--visible');\n    } else {\n      group.style.visibility = 'hidden';\n      group.style.overflow = 'hidden';\n      group.style.height = '0px';\n      group.classList.remove('st-form-groups__group--visible');\n    }\n  }\n\n  toggleDisabled(group, enabled) {\n    this.inputElements(group).forEach(elem => elem.disabled = !enabled);\n  }\n\n  inputElements(group) {\n    return group.querySelectorAll('input, select, textarea, button')\n  }\n\n  findGroups(target) {\n    let value = this.getValue(target);\n    if (!value) {\n      return [];\n    } else {\n      return this.groups.filter(group => this.isMatch(group, target.name, value));\n    }\n  }\n\n  isMatch(group, targetName, targetValue) {\n    return this.extractIDs(group.getAttribute('data-form-group-id')).some(id => {\n      let [name, value] = this.extractNameValue(id);\n      return (!name || name == targetName) && value == targetValue\n    });\n  }\n\n  getValue(target) {\n    if (target.matches('select')) {\n      return target.options[target.selectedIndex].value;\n    } else if (target.matches('input[type=checkbox]')) {\n      return target.checked ? target.value : null;\n    } else if (target.matches('input[type=radio]')) {\n      let checked = this.scope.findElement(`input[type=radio][name=\"${target.name}\"]:checked`);\n      return checked ? checked.value : null;\n    }\n  }\n\n  extractIDs(str) {\n    if (str.startsWith('[')) {\n      return [].concat(this.parseJSON(str));\n    } else {\n      return [].concat(str);\n    }\n  }\n\n  extractNameValue(id) {\n    if (id.includes(':')) {\n      return id.split(':', 2)\n    } else {\n      return [null, id];\n    }\n  }\n\n  parseJSON(str) {\n    try {\n      return JSON.parse(str);\n    } catch(error) {\n      return str;\n    }\n  }\n}\n"],"names":["Controller","groups","scope","findAllElements","togglers","context","bindingObserver","bindings","filter","binding","action","methodName","map","element","connect","this","enableAnim","forEach","group","toggleGroup","toggler","toggleBy","setTimeout","enabled","classList","remove","add","toggle","e","elem","findGroups","flag","modeValue","toggleDisabled","toggleVisible","visible","style","visibility","overflow","height","scrollHeight","inputElements","disabled","querySelectorAll","target","value","getValue","isMatch","name","targetName","targetValue","extractIDs","getAttribute","some","id","extractNameValue","matches","options","selectedIndex","checked","findElement","str","startsWith","concat","parseJSON","includes","split","JSON","parse","error","values","mode","String"],"mappings":"gEAG6BA,EAKvBC,aACF,YAAYC,MAAMC,gBAAgB,wBAGhCC,eACF,YAAYC,QAAQC,gBAAgBC,SACxBC,OAAOC,GAAwC,UAA7BA,EAAQC,OAAOC,YACjCC,IAAIH,GAAWA,EAAQC,OAAOG,SAG5CC,UACEC,KAAKC,YAAW,GAChBD,KAAKd,OAAOgB,QAAQC,GAASH,KAAKI,YAAYD,GAAO,IACrDH,KAAKX,SAASa,QAAQG,GAAWL,KAAKM,SAASD,IAC/CE,WAAW,IAAMP,KAAKC,YAAW,GAAO,KAG1CA,WAAWO,GACTR,KAAKd,OAAOgB,QAAQC,IACdK,EACFL,EAAMM,UAAUC,OAAO,iCAEvBP,EAAMM,UAAUE,IAAI,mCAK1BC,OAAOC,GACLb,KAAKd,OAAOgB,QAAQC,GAASH,KAAKI,YAAYD,GAAO,IACrDH,KAAKX,SAASa,QAAQG,GAAWL,KAAKM,SAASD,IAGjDC,SAASQ,GACPd,KAAKe,WAAWD,GAAMZ,QAAQC,GAASH,KAAKI,YAAYD,GAAO,IAGjEC,YAAYD,EAAOa,GACjB,MAAsB,YAAlBhB,KAAKiB,eACKC,eAAef,EAAOa,QAEtBG,cAAchB,EAAOa,GAIrCG,cAAchB,EAAOiB,GACfA,GACFjB,EAAMkB,MAAMC,WAAa,GACzBnB,EAAMkB,MAAME,SAAW,GACvBpB,EAAMkB,MAAMG,OAASrB,EAAMsB,aAAe,KAC1CtB,EAAMM,UAAUE,IAAI,oCAEpBR,EAAMkB,MAAMC,WAAa,SACzBnB,EAAMkB,MAAME,SAAW,SACvBpB,EAAMkB,MAAMG,OAAS,MACrBrB,EAAMM,UAAUC,OAAO,mCAI3BQ,eAAef,EAAOK,GACpBR,KAAK0B,cAAcvB,GAAOD,QAAQY,GAAQA,EAAKa,UAAYnB,GAG7DkB,cAAcvB,GACZ,OAAOA,EAAMyB,iBAAiB,mCAGhCb,WAAWc,GACT,IAAIC,EAAQ9B,KAAK+B,SAASF,GAC1B,OAAKC,OAGS5C,OAAOO,OAAOU,GAASH,KAAKgC,QAAQ7B,EAAO0B,EAAOI,KAAMH,IAF7D,GAMXE,QAAQ7B,EAAO+B,EAAYC,GACzB,YAAYC,WAAWjC,EAAMkC,aAAa,uBAAuBC,KAAKC,IACpE,IAAKN,EAAMH,GAAS9B,KAAKwC,iBAAiBD,GAC1C,QAASN,GAAQA,GAAQC,IAAeJ,GAASK,IAIrDJ,SAASF,GACP,GAAIA,EAAOY,QAAQ,UACjB,OAAOZ,EAAOa,QAAQb,EAAOc,eAAeb,SACnCD,EAAOY,QAAQ,wBACxB,OAAOZ,EAAOe,QAAUf,EAAOC,MAAQ,QAC9BD,EAAOY,QAAQ,qBAAsB,CAC9C,IAAIG,EAAU5C,KAAKb,MAAM0D,uCAAuChB,EAAOI,mBACvE,OAAOW,EAAUA,EAAQd,MAAQ,MAIrCM,WAAWU,GACT,OAAIA,EAAIC,WAAW,KACV,GAAGC,OAAOhD,KAAKiD,UAAUH,IAEzB,GAAGE,OAAOF,GAIrBN,iBAAiBD,GACf,OAAIA,EAAGW,SAAS,KACPX,EAAGY,MAAM,IAAK,GAEd,CAAC,KAAMZ,GAIlBU,UAAUH,GACR,IACE,OAAOM,KAAKC,MAAMP,GAClB,MAAMQ,GACN,OAAOR,MArHJS,OAAS,CACdC,KAAMC"}